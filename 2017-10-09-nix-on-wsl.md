title: Nix on Windows Subsystem for Linux
author: Jonas Chevalier
---

While testing the 17.09 NixOS release, I had the idea of testing the Nix installation under WSL to see if it worked. And it worked! Success!

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Testing the NixOS 17.09 release under Windows Subsystem for Linux. Works like a charm. <a href="https://t.co/19qvXjDpDv">pic.twitter.com/19qvXjDpDv</a></p>&mdash; zimbatm (@zimbatm) <a href="https://twitter.com/zimbatm/status/911992348858601474?ref_src=twsrc%5Etfw">September 24, 2017</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

To place things in context, WSL is a Linux emulator for Windows(tm) and developed by Microsoft. It’s a subsystem that maps all the Linux syscalls to the NT kernel, and has as its main advantage the potential of being faster than Virtual Machines. Linux programs can also call directly into Windows programs.

The last time that I tried, nix wasn’t working properly because of some missing syscalls. It’s not perfect yet as demonstrated below but it’s an exciting development; a whole class of programs can now be executed directly onto Windows, programs which would never be translated to work natively.

## How to install

Enable and install WSL following these instructions:
https://msdn.microsoft.com/en-us/commandline/wsl/install_guide

Make sure to have the latest version of Windows 10 installed. I had this version at the time of install:

* Windows Edition: Windows 10 Pro
* Windows Version: 1703
* Windows OS Build: 15063.540
* System Type: 64-bit operating system

Start the “Bash On Ubuntu On Windows” program and type `curl https://nixos.org/nix/install | sh`

Success!

## Known issues
### Curl is hanging

Hit Ctrl+C and retry

### Nix installation crash

Update Windows and try again.

### Nix-shell is broken

Fails with synchronous i/o disk error
https://github.com/NixOS/nix/issues/1203

Workaround: edit /etc/nix/nix.conf and add use-sqlite-wal=false

### It’s slow

Yes, especially I/O seems quite slow

### Nix environment is not started in new logins.

Workaround: . ~/.profile

Solution: ????

## Conclusion

For now, it's just a technology preview that opens new possibilities. Hopefully in the future, when I/O gets faster, it will also be possible to develop Linux programs under WSL directly.

## Resources

* NixOS 17.09: https://nixos.org/nixos/manual/release-notes.html#sec-release-17.09
* FAQ: https://msdn.microsoft.com/en-gb/commandline/wsl/faq
* Home page: https://github.com/Microsoft/BashOnWindows



